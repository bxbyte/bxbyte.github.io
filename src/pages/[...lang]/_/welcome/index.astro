---
import { Section } from '@/components/sections'
import { getLocaleContent } from '@/libs/i18n'
import locales from './locales'
import ChunkedImage from '@/components/ChunkedImage.astro'
import backImg from './back.png'
// import GridArt from '@/components/tiles'
import { grainUrl } from '@/styles/theme'

const content = getLocaleContent(locales, Astro)
---

<Section id="welcome">
	<div slot="back">
		<ChunkedImage
			src={backImg}
			rows={2}
			cols={8}
			preserveAspectRatio="xMidYMin slice"
			sharpCallbacks={[
				{ call: 'greyscale' },
				{ call: 'webp', params: [{ quality: 1, alphaQuality: 0 }] },
			]}
		/>
		<div
			style={{
				maskImage: [
					'linear-gradient(#000 80%, #fff)',
					grainUrl,
					'linear-gradient(#fff, #fff)',
				].join(),
			}}
		>
			<!-- Used as a mask since the world's greatest browser engine
			  can't fucking handle a backdrop blur on a real masked element -->
		</div>
	</div>

	<div class="hi">
		<p>{content.hi}</p>
		<h1>{content.iam}</h1>
		<p>{content.status}</p>
	</div>

	<div class="infos">
		<p>{content.what}</p>
	</div>

	<p class="footer">{content.easteregg}</p>
</Section>

<style lang="scss">
	@use '@/styles/layout.module.scss';

	:global(.back) {
		display: flex;
		align-items: flex-end;
		user-select: none;

		& > div {
			& > div {
				mask-mode: luminance;
				mask-size: 80%;
				mask-composite: add, exclude;
				background-color: theme.$color-white;
				height: 100%;
			}

			svg {
				position: absolute;
				bottom: 0;
				filter: contrast(calc(0.75 + 1 * theme.$bool-is-dark))
					brightness(calc(0.5 + (1 - theme.$bool-is-dark)));
				width: 100%;
				height: 50%;
			}
		}
	}

	:global(#welcome) {
		display: grid;
		grid-template-areas:
			'. .'
			'. .'
			'a a'
			'b b'
			'. f';
		// display: flex;
		// align-items: center;
		clip-path: inset(0 0 0 0);
		min-height: min(100vh, layout.$window-max-width / 1.33);
	}

	.hi {
		grid-area: a;
		font-size: 1.75rem;

		h1 {
			font-size: 2em;
		}
	}

	.infos {
		grid-area: b;
		backdrop-filter: blur(0.5rem) brightness(115%);
		box-sizing: border-box;
		margin: auto;
		border: 1px solid theme.$color-dark-grey;
		border-radius: 0.5rem;
		padding: 0.75rem;
		width: 100%;
		height: fit-content;
	}

	.footer {
		grid-area: f;
		margin: auto 0 0 auto;
		color: theme.$color-black;
	}
</style>
