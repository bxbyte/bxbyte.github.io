---
import layout from '@/styles/layout.module.scss'
import locals from './locals'
import ActiveLink from '@/components/navigation/ActiveLink.astro'
import type { HTMLAttributes } from 'astro/types'
import type Head from '@/components/Head.astro'
import Skeleton from '@/layouts//Skeleton.astro'

import LocaleSwitch from '@/components/locale-switch'
import ThemeSwitch from '@/components/theme-switch'

import { useLocaleContents } from '@/libs/i18n'
import { Block } from '@/components/sections'

export interface Props extends HTMLAttributes<'main'> {
	head?: LocalComponentProps<typeof Head>
}

export const { getStaticPaths, getLocaleContent } = useLocaleContents(locals)
const content = getLocaleContent(Astro)

const { head, ...props } = Astro.props
---

<Skeleton>
	<!-- Slot forwarding -->
	<slot name="head" slot="head" />

	<Block tag="header" transition:persist-props>
		<nav>
			<ul>
				{
					content.navLinks.map(({ label, ...props }) => (
						<li>
							<ActiveLink {...props}>{label}</ActiveLink>
						</li>
					))
				}
			</ul>
		</nav>
		<div>
			<LocaleSwitch />
			<ThemeSwitch />
		</div>
	</Block>

	<main transition:animate="fade" {...props}>
		<slot />
	</main>

	<Block tag="footer" transition:persist class={layout.chunk}>
		<div>
			{
				content.footer.links.map(({ name, links }) => (
					<ul>
						<li>{name}</li>
						{links.map(({ label, ...props }) => (
							<li>
								<ActiveLink {...props}>{label}</ActiveLink>
							</li>
						))}
					</ul>
				))
			}
			<pre translate="no">{content.footer.asciiArt}</pre>
		</div>
		<p>
			{content.footer.copyrigth.whenwho}
			<ActiveLink href={content.footer.copyrigth.license.href}
				>{content.footer.copyrigth.license.label}</ActiveLink
			>
		</p>
	</Block>
</Skeleton>

<style lang="scss">
	@use '@/styles/layout.module.scss' as layout;

	body {
		display: flex;
		flex-direction: column;
		align-items: center;

		& > main {
			flex: 1;
			width: 100%;
		}

		& > header {
			justify-content: space-between;
			backdrop-filter: blur(1em);
			transition: transform 0.2s ease-in-out;
			background: linear-gradient(
				theme.$color-white,
				color-mix(in srgb, theme.$color-white, transparent 40%)
			);
			user-select: none;

			&,
			* {
				display: flex;
				flex-direction: row;
				align-items: center;
				gap: 1em;
			}

			img {
				height: 2em;
			}
		}

		& > footer {
			gap: 0.5em;
			border-top: 1px solid theme.$color-grey;
			user-select: none;

			&,
			ul {
				display: flex;
				flex-direction: column;
			}

			ul {
				& > *:first-child {
					margin-bottom: 0.5em;
					font-weight: 500;
					text-underline-offset: 0.2em;
				}
			}

			div {
				display: flex;
				position: relative;
				flex-flow: row wrap;
				gap: 1em;
			}

			pre {
				right: 0;
				bottom: 0;
				opacity: 0.4;
				margin-top: auto;
				margin-left: auto;
			}

			& > p {
				align-self: end;

				a {
					color: theme.$color-main;
					--x-factor: 1;
				}
			}
		}
	}
</style>
